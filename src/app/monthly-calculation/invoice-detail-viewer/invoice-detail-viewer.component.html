<!-- Betöltés -->
<div *ngIf="isLoading" class="text-center text-gray-600 py-6">
  Betöltés...
</div>

<!-- Hibaüzenet -->
<div *ngIf="errorMessage" class="text-center text-red-600 font-medium py-4">
  {{ errorMessage }}
</div>

<!-- Számla kiválasztás -->
<div class="border rounded-xl p-6 shadow-md bg-white mb-6">
  <h2 class="text-xl font-semibold text-gray-800 mb-4">Számla kiválasztás</h2>
  <select
    appTailwindStyledSelect="w-60"
    [ngModel]="selectedInvoiceId"
    (ngModelChange)="onInvoiceChange($event)"
    class="w-60"
  >
    <option [value]="null" disabled>Válassz egy számlát</option>
    <option *ngFor="let invoiceElement of invoicesCombo" [value]="invoiceElement.id">
      {{ invoiceElement.invoice_name }}
    </option>
  </select>
</div>

<!-- Számla részletek és költségek -->
<div *ngIf="invoiceWithCosts.length > 0" class="space-y-8">
  <div
    *ngFor="let invoiceWithCost of invoiceWithCosts"
    class="bg-white rounded-2xl shadow-md p-6"
  >
    <!-- Számla részletek -->
    <header class="mb-4">
      <h2 class="text-lg font-semibold text-gray-800">
        {{ invoiceWithCost.invoice_name }}
      </h2>
      <p class="text-gray-500 text-sm">{{ invoiceWithCost.invoice_note }}</p>
    </header>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-700 mb-6">
      <p><span class="font-medium">Felhasználó:</span> {{ invoiceWithCost.user }}</p>
      <p>
        <span class="font-medium">Létrehozás dátuma:</span>
        {{ invoiceWithCost.create_invoice_date | date: 'mediumDate' }}
      </p>
      <p><span class="font-medium">Összeg:</span> {{ invoiceWithCost.amount | number }} Ft</p>
      <p>
        <span class="font-medium">Engedélyezett számla:</span>
        <span
          [ngClass]="{
            'text-green-600 font-semibold': invoiceWithCost.enable_invoice === 1,
            'text-red-600 font-semibold': invoiceWithCost.enable_invoice !== 1
          }"
        >
          {{ invoiceWithCost.enable_invoice === 1 ? 'Igen' : 'Nem' }}
        </span>
      </p>
    </div>

    <!-- Költségek -->
    <h3 class="text-md font-semibold text-gray-800 mb-3">Költségek</h3>
    <div *ngIf="invoiceWithCost.cost_invoice.length > 0; else noCosts" class="space-y-4">
      <div
        *ngFor="
          let costInvoice of getPaginatedCosts(invoiceWithCost.id, invoiceWithCost.cost_invoice)
        "
        class="border rounded-lg p-4 bg-gray-50 shadow-sm"
      >
        <h4 class="font-medium text-blue-800 mb-2">{{ costInvoice.cost_name }}</h4>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-gray-700">
          <p><span class="font-medium">Számla:</span> {{ costInvoice.invoice }}</p>
          <p><span class="font-medium">Felhasználó:</span> {{ costInvoice.user }}</p>
          <p><span class="font-medium">Deviza:</span> {{ costInvoice.dev }}</p>
          <p><span class="font-medium">Költségcsoport:</span> {{ costInvoice.costgroup }}</p>
          <p>
            <span class="font-medium">Megjegyzés:</span>
            {{ costInvoice.cost_note || 'Nincs megjegyzés' }}
          </p>
          <p><span class="font-medium">Összeg:</span> {{ costInvoice.amount | number }} Ft</p>
          <p>
            <span class="font-medium">Kifizetve:</span>
            <span
              [ngClass]="{
                'text-green-600 font-semibold': costInvoice.paid === 1,
                'text-red-600 font-semibold': costInvoice.paid !== 1
              }"
            >
              {{ costInvoice.paid === 1 ? 'Igen' : 'Nem' }}
            </span>
          </p>
          <p>
            <span class="font-medium">Kifizetés dátuma:</span>
            {{ costInvoice.paid_date | date: 'mediumDate' }}
          </p>
          <p>
            <span class="font-medium">Létrehozás dátuma:</span>
            {{ costInvoice.create_cost_date | date: 'mediumDate' }}
          </p>
          <p>
            <span class="font-medium">Költség dátuma:</span>
            {{ costInvoice.cost_date | date: 'mediumDate' }}
          </p>
        </div>
      </div>
    </div>

    <ng-template #noCosts>
      <p class="text-gray-500 text-sm">Nincsenek költségek ehhez a számlához.</p>
    </ng-template>

    <!-- Lapozó -->
    <div class="flex justify-center items-center mt-6 space-x-4">
      <button
        (click)="prevPage.emit(invoiceWithCost.id)"
        [disabled]="(costCurrentPage[invoiceWithCost.id] || 1) === 1"
        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg shadow hover:bg-gray-300 disabled:opacity-50"
      >
        Előző
      </button>
      <span class="text-gray-700 font-semibold">
        Oldal {{ costCurrentPage[invoiceWithCost.id] || 1 }} /
        {{ Math.ceil(invoiceWithCost.cost_invoice.length / pageSize) }}
      </span>
      <button
        (click)="
          nextPage.emit({ invoiceId: invoiceWithCost.id, costs: invoiceWithCost.cost_invoice })
        "
        [disabled]="
          (costCurrentPage[invoiceWithCost.id] || 1) >=
          Math.ceil(invoiceWithCost.cost_invoice.length / pageSize)
        "
        class="px-4 py-2 bg-indigo-500 text-white rounded-lg shadow hover:bg-indigo-600 disabled:opacity-50"
      >
        Következő
      </button>
    </div>
  </div>
</div>
